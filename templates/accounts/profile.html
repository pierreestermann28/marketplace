{% extends "layouts/app.html" %}
{% load profile_tags %}
{% block page_content %}
  <div class="container-app py-10">
    <div class="space-y-6">
      <section class="rounded-3xl border border-ink-100 bg-white/90 p-6 shadow-soft">
        <div class="flex flex-col gap-6 lg:flex-row lg:items-center">
          <div class="flex items-center gap-4">
            <div class="flex h-16 w-16 items-center justify-center rounded-2xl bg-brand/10 text-brand">
              <span class="text-xl font-bold">{{ object.get_full_name|default:object.username|slice:":1"|upper }}</span>
            </div>
            <div>
              <p class="text-xs uppercase tracking-[0.4em] text-ink-500">Profil</p>
              <h1 class="text-3xl font-semibold text-ink-900">{{ object.get_full_name|default:object.username }}</h1>
              <p class="text-sm text-ink-500">{{ object.email }}</p>
            </div>
          </div>
          <div class="flex flex-wrap gap-4 text-sm text-ink-600">
            <div class="flex flex-col rounded-2xl border border-ink-100 bg-ink-50 px-4 py-2">
              <span class="text-xs uppercase tracking-[0.3em] text-ink-400">Annonces</span>
              {% if object.listings.count %}
                <span class="text-lg font-semibold text-ink-900">{{ object.listings.count }}</span>
              {% else %}
                <span class="text-lg font-semibold text-ink-900">0</span>
              {% endif %}
            </div>
            <div class="flex flex-col rounded-2xl border border-ink-100 bg-ink-50 px-4 py-2">
              <span class="text-xs uppercase tracking-[0.3em] text-ink-400">Réputation</span>
              <span class="text-lg font-semibold text-ink-900">
                {% if reputation_stats.rating %}
                  {{ reputation_stats.rating }}/5
                {% else %}
                  —
                {% endif %}
              </span>
            </div>
            <div class="flex flex-col rounded-2xl border border-ink-100 bg-ink-50 px-4 py-2">
              <span class="text-xs uppercase tracking-[0.3em] text-ink-400">Messages</span>
              {% if object.conversations.count %}
                <span class="text-lg font-semibold text-ink-900">{{ object.conversations.count }}</span>
              {% else %}
                <span class="text-lg font-semibold text-ink-900">0</span>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="mt-6 flex flex-wrap gap-3 text-xs uppercase tracking-[0.3em] text-ink-500">
          <a href="{% url 'my_listings' %}" class="hover:text-ink-900">Mes annonces</a>
          <a href="/messages/" class="hover:text-ink-900">Conversations</a>
        </div>
        {% if not object.listings.exists %}
          <p class="mt-3 text-xs text-ink-500">Aucune annonce publiée pour le moment.</p>
        {% endif %}
      </section>
      <section class="grid gap-6 lg:grid-cols-[1fr_0.7fr]">
        <div class="space-y-4">
          <div class="card card-body space-y-4">
            <div class="text-sm uppercase tracking-[0.3em] text-ink-500">Avis récents</div>
            {% if reviews_received %}
              <div class="space-y-3">
                {% for review in reviews_received %}
                  <div class="space-y-2 border border-ink-100 bg-white p-4">
                    <div class="flex items-center justify-between text-xs text-ink-500">
                      <span>{{ review.role|human_role }}</span>
                      <span>{{ review.created_at|date:"d M Y" }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm font-semibold text-ink-900">
                      <i data-lucide="star" class="h-4 w-4 text-yellow-500"></i>
                      {{ review.rating }}/5
                    </div>
                    {% if review.comment %}
                      <p class="text-sm text-ink-700">{{ review.comment }}</p>
                    {% endif %}
                    <div class="text-xs text-ink-500">
                      Sur l'annonce : {{ review.order.listing.title }}
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <p class="text-sm text-ink-500">Cet utilisateur n'a pas encore d'avis.</p>
            {% endif %}
          </div>
        </div>
        <aside class="space-y-4">
          <div class="card card-body space-y-3">
            <h2 class="text-sm font-semibold uppercase tracking-[0.3em] text-ink-500">Actions</h2>
            <a href="/messages/" class="flex items-center gap-2 text-sm text-ink-600 hover:text-ink-900">
              <i data-lucide="message-circle" class="h-4 w-4"></i> Voir les conversations
            </a>
            {% if user == object %}
              <a href="/sell/create/" class="flex items-center gap-2 text-sm text-ink-600 hover:text-ink-900">
                <i data-lucide="plus" class="h-4 w-4"></i> Publier une annonce
              </a>
            {% endif %}
          </div>
          {% include "components/reputation/summary.html" with stats=reputation_stats only %}
        </aside>
      </section>
    </div>
  </div>
{% endblock %}
